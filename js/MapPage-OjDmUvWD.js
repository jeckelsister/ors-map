import{j as t}from"./index-CuNe8dY9.js";import{r as e}from"./router-thpCtGxH.js";import{c as ce,a as ie,b as ue,r as de,d as me,e as he,f as pe,g as fe,i as ge,h as be,j as xe,T as ve,M as ye,N as Ce}from"./Navigation-Dkb4EvuO.js";import{F as X}from"./icons-DQM9_izd.js";import"./vendor-gH-7aFTg.js";import"./leaflet-BloEYaw0.js";import"./Logo-CG7twSBP.js";const Q=async r=>r?await(await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(r)}`)).json():[];function we(){const[r,n]=e.useState(""),[o,s]=e.useState(""),[l,a]=e.useState([]),[i,d]=e.useState([]),[u,f]=e.useState(null),[g,M]=e.useState(null);return e.useEffect(()=>{const h=setTimeout(()=>{Q(r).then(a)},300);return()=>clearTimeout(h)},[r]),e.useEffect(()=>{const h=setTimeout(()=>{Q(o).then(d)},300);return()=>clearTimeout(h)},[o]),{startQuery:r,setStartQuery:n,startSuggestions:l,setStartSuggestions:a,handleStartSuggestion:h=>{f({lat:Number(h.lat),lng:Number(h.lon),name:h.display_name}),n(h.display_name)},endQuery:o,setEndQuery:s,endSuggestions:i,setEndSuggestions:d,handleEndSuggestion:h=>{M({lat:Number(h.lat),lng:Number(h.lon),name:h.display_name}),s(h.display_name)},traceStart:u,traceEnd:g,setTraceStart:f,setTraceEnd:M}}const je=r=>r<1e3?`${Math.round(r)} m`:`${(r/1e3).toFixed(2)} km`,ke=r=>{const n=Math.floor(r/3600),o=Math.floor(r%3600/60);return n>0?`${n}h ${o}min`:`${o}min`},U=(r,n,o=6)=>`${r.toFixed(o)}, ${n.toFixed(o)}`,Ne=(r,n)=>[(r.lat+n.lat)/2,(r.lng+n.lng)/2];function Me({traceStart:r,traceEnd:n,showTrace:o,profile:s="foot-hiking",initialMapLayer:l="osmFrance"}){const a=e.useRef(null),i=e.useRef({}),d=e.useRef({}),u=e.useRef(null),f=e.useRef(null),g=e.useRef(!1),M=e.useRef(!1),j=e.useRef(null),[L,h]=e.useState(null),[T,b]=e.useState(null),[y,A]=e.useState(!1),R=e.useMemo(()=>r?.lat&&r?.lng&&n?.lat&&n?.lng,[r?.lat,r?.lng,n?.lat,n?.lng]),B=e.useCallback(async c=>{const{summary:p,ascent:S,descent:I}=c.properties,k=je(p.distance),x=ke(p.duration);if(typeof S=="number"&&typeof I=="number")return{duration:x,distance:k,ascent:S,descent:I};try{const N=await ce(c.geometry.coordinates);return{duration:x,distance:k,...N}}catch{return{duration:x,distance:k,ascent:null,descent:null}}},[]);e.useEffect(()=>{const c=()=>{if(!a.current){const I=ge("map",[46.603354,1.888334],13,l);I&&(a.current=I)}};if(document.getElementById("map"))c();else{const S=new MutationObserver((I,k)=>{document.getElementById("map")&&(c(),k.disconnect())});return S.observe(document.body,{childList:!0,subtree:!0}),()=>S.disconnect()}},[l]),e.useEffect(()=>{if(!o||!R||!a.current)return;if(i.current[s]){const p=d.current[s];if(p){b(p),A(!1);return}}return(async()=>{j.current&&j.current.abort(),j.current=new AbortController,h(null),A(!0);try{if(r&&n){const k=Ne(r,n);a.current?.setView(k,13)}const p=await be([r.lat,r.lng],[n.lat,n.lng],s,"eyJvcmciOiI1YjNjZTM1OTc4NTExMTAwMDFjZjYyNDgiLCJpZCI6IjEyYTBhMTVhZmE0ZGI1N2E5NzgyMzkyOWQyMjIxZTVmMWMzODFkM2I5Njg3ZTE2ZTMyNDA3ZDA2IiwiaCI6Im11cm11cjY0In0=");if(!p?.features?.length)throw new Error("No route found between these two points.");const S=p.features[0],I=await B(S);if(a.current){const k=xe(a.current,p,s);k&&(i.current[s]=k)}d.current[s]=I,b(I)}catch(p){h(p instanceof Error?p.message:"Error while retrieving the route.")}finally{A(!1)}})(),()=>{}},[o,R,s,B,r,n]),e.useEffect(()=>{o||(Object.values(i.current).forEach(c=>{c&&c.remove&&c.remove()}),i.current={},d.current={},b(null))},[o]),e.useEffect(()=>()=>{j.current&&j.current.abort(),u.current&&u.current(),f.current&&f.current(),a.current&&(ie(a.current,"map"),a.current=null,i.current={})},[]);const C=e.useCallback(c=>{const p=i.current[c];p&&p.remove&&(p.remove(),delete i.current[c],delete d.current[c],c===s&&b(null))},[s]),$=e.useCallback(()=>Object.keys(i.current),[]),w=e.useCallback(c=>{if(!a.current)return;u.current&&u.current(),u.current=ue(a.current,c,"start"),g.current=!0;const p=a.current.getContainer();p&&(p.style.cursor="crosshair",p.style.transition="cursor 0.2s ease")},[]),E=e.useCallback(()=>{if(a.current&&(u.current&&(u.current(),u.current=null),g.current=!1,!M.current)){const c=a.current.getContainer();c&&(c.style.cursor="",c.style.transition="cursor 0.2s ease")}},[]),_=e.useCallback(()=>{a.current&&de(a.current)},[]),D=e.useCallback(c=>{if(!a.current)return;f.current&&f.current(),f.current=me(a.current,c),M.current=!0;const p=a.current.getContainer();p&&(p.style.cursor="crosshair",p.style.transition="cursor 0.2s ease")},[]),z=e.useCallback(()=>{if(a.current&&(f.current&&(f.current(),f.current=null),M.current=!1,!g.current)){const c=a.current.getContainer();c&&(c.style.cursor="",c.style.transition="cursor 0.2s ease")}},[]),P=e.useCallback(()=>{a.current&&he(a.current)},[]),V=e.useCallback(c=>{a.current&&pe(a.current,c.lat,c.lng)},[]),O=e.useCallback(c=>{a.current&&fe(a.current,c.lat,c.lng)},[]);return{mapRef:a,error:L,summary:T,isLoading:y,removeRoute:C,getActiveRoutes:$,enableMapClickForStart:w,disableMapClickForStart:E,clearStartMarker:_,enableMapClickForEnd:D,disableMapClickForEnd:z,clearEndMarker:P,createStartMarkerFromLocation:V,createEndMarkerFromLocation:O}}const Se=(r={})=>{const{enableHighAccuracy:n=!0,timeout:o=1e4,maximumAge:s=6e4}=r,l="geolocation"in navigator;return{getCurrentPosition:e.useCallback((i,d)=>{if(!l){d?.("La géolocalisation n'est pas supportée par ce navigateur.");return}navigator.geolocation.getCurrentPosition(u=>{const{latitude:f,longitude:g}=u.coords;i({lat:f,lng:g,name:"Ma position"})},u=>{const g={1:"Permission refusée",2:"Position indisponible",3:"Délai d'attente dépassé"}[u.code]||u.message;d?.(`Impossible d'obtenir la position : ${g}`)},{enableHighAccuracy:n,timeout:o,maximumAge:s})},[l,n,o,s]),isSupported:l}};function H({children:r,className:n="",type:o="button",onClick:s,...l}){return t.jsx("button",{type:o,className:"px-3 py-2 rounded-lg border font-semibold transition-all duration-150 focus:outline-none focus:ring-2 focus:ring-blue-300 "+n,onClick:s,...l,children:r})}const G=e.memo(({icon:r,onClick:n,isActive:o=!1,title:s,label:l,className:a="","aria-label":i})=>{const f=`p-2 border rounded transition-all duration-200 ${o?"bg-blue-600 text-white border-blue-600 shadow-md":"bg-white text-gray-600 border-gray-300 hover:border-blue-400"} ${a}`.trim();return t.jsxs(H,{className:f,onClick:n,title:s,"aria-label":i||s,children:[r,l&&t.jsx("span",{className:"hidden sm:inline ml-1",children:l})]})});G.displayName="IconButton";const ee=e.memo(({className:r="h-5 w-5"})=>t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[t.jsx("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2",fill:"none"}),t.jsx("circle",{cx:"12",cy:"12",r:"4",fill:"currentColor"})]}));ee.displayName="GeolocationIcon";const K=e.memo(({className:r="h-5 w-5",isAnimated:n=!1})=>t.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:`${r} transition-all duration-200 ${n?"animate-pulse":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}));K.displayName="MapPinIcon";const Ie=e.memo(({className:r="h-5 w-5"})=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:r,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}));Ie.displayName="SearchIcon";const Re=e.memo(({className:r="h-5 w-5"})=>t.jsxs("svg",{className:`${r} animate-spin`,xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[t.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),t.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}));Re.displayName="LoadingIcon";const Y=e.memo(({isActive:r,activeLabel:n="Actif",inactiveLabel:o="Inactif",activeIcon:s,variant:l="default"})=>{const a=e.useMemo(()=>({default:"bg-green-500",success:"bg-green-500",warning:"bg-yellow-500",error:"bg-red-500"})[l],[l]),i=e.useMemo(()=>t.jsxs("span",{className:"flex items-center gap-1",children:[s||t.jsx("span",{className:`inline-block w-2 h-2 ${a} rounded-full animate-ping`}),n]}),[s,n,a]);return r?i:t.jsx("span",{children:o})});Y.displayName="StatusIndicator";function Le({label:r,value:n,onChange:o,suggestions:s,onSuggestionClick:l,placeholder:a="Nom du lieu",className:i=""}){const[d,u]=e.useState(!1),[f,g]=e.useState(-1),M=e.useRef(null),j=e.useRef(null),L=`autocomplete-input-${Math.random().toString(36).substr(2,9)}`;e.useEffect(()=>{u(s.length>0&&n.length>0),g(-1)},[s,n]);const h=b=>{if(d)switch(b.key){case"ArrowDown":b.preventDefault(),g(y=>y<s.length-1?y+1:0);break;case"ArrowUp":b.preventDefault(),g(y=>y>0?y-1:s.length-1);break;case"Enter":b.preventDefault(),f>=0&&(l(s[f]),u(!1));break;case"Escape":u(!1),g(-1);break}},T=b=>{l(b),u(!1),g(-1)};return t.jsxs("div",{className:`relative ${i}`,children:[t.jsx("label",{htmlFor:L,className:"block text-sm font-medium text-gray-700 mb-1",children:r}),t.jsx("input",{id:L,ref:M,type:"text",value:n,onChange:o,onKeyDown:h,onFocus:()=>u(s.length>0&&n.length>0),onBlur:()=>{setTimeout(()=>u(!1),150)},placeholder:a,className:"w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors"}),d&&s.length>0&&t.jsx("ul",{ref:j,className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-60 overflow-auto",children:s.map((b,y)=>t.jsxs("li",{onClick:()=>T(b),className:`px-3 py-2 cursor-pointer text-sm hover:bg-blue-50 transition-colors ${y===f?"bg-blue-100":""}`,children:[t.jsx("div",{className:"font-medium text-gray-900",children:b.display_name}),b.type&&t.jsx("div",{className:"text-xs text-gray-500",children:b.type})]},`${b.place_id||b.display_name}-${y}`))})]})}function Ae(r){return t.jsx(Le,{...r,className:"mb-4"})}const J=e.memo(({label:r,value:n,onChange:o,suggestions:s,onSuggestionClick:l,setSuggestions:a,placeholder:i,actions:d=[]})=>t.jsx("div",{className:"space-y-2",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Ae,{label:r,value:n,onChange:o,suggestions:s,onSuggestionClick:l,setSuggestions:a,placeholder:i}),d.map((u,f)=>t.jsx("div",{children:u},f))]})}));J.displayName="LocationInput";const $e=({startQuery:r,setStartQuery:n,startSuggestions:o,setStartSuggestions:s,handleStartSuggestion:l,endQuery:a,setEndQuery:i,endSuggestions:d,setEndSuggestions:u,handleEndSuggestion:f,setTraceStart:g,setTraceEnd:M,onCreateTrace:j,enableMapClickForStart:L,disableMapClickForStart:h,clearStartMarker:T,enableMapClickForEnd:b,disableMapClickForEnd:y,clearEndMarker:A,createStartMarkerFromLocation:R,createEndMarkerFromLocation:B})=>{const[C,$]=e.useState(!1),[w,E]=e.useState(!1),{getCurrentPosition:_}=Se();e.useEffect(()=>()=>{C&&h(),w&&y()},[C,w,h,y]);const D=e.useCallback((m,v,W)=>({lat:m,lng:v,name:W}),[]),z=e.useCallback(m=>({lat:Number(m.lat),lng:Number(m.lon),name:m.display_name}),[]),P=e.useCallback(()=>{_(m=>{const v=U(m.lat,m.lng);n(v),g(m),R(m)},m=>alert(m))},[_,n,g,R]),V=e.useCallback(()=>{C?(h(),$(!1)):(w&&(y(),E(!1)),L((m,v)=>{const W=U(m,v),Z=D(m,v,"Point sélectionné sur la carte");n(W),g(Z),$(!1),h()}),$(!0))},[C,w,L,h,y,n,g,D]),O=e.useCallback(()=>{w?(y(),E(!1)):(C&&(h(),$(!1)),b((m,v)=>{const W=U(m,v),Z=D(m,v,"Point d'arrivée sélectionné sur la carte");i(W),M(Z),E(!1),y()}),E(!0))},[w,C,b,y,h,i,M,D]),c=e.useCallback(m=>{const v=m.target.value;n(v),v.trim()===""&&T()},[n,T]),p=e.useCallback(m=>{const v=m.target.value;i(v),v.trim()===""&&A()},[i,A]),S=e.useCallback(m=>{l(m);const v=z(m);R(v)},[l,z,R]),I=e.useCallback(m=>{f(m);const v=z(m);B(v)},[f,z,B]),k=e.useMemo(()=>r.trim()!==""&&a.trim()!=="",[r,a]),x=e.useCallback((m,v)=>`ml-1 flex items-center gap-1 border shadow-sm transition-all duration-200 hover:shadow-md ${m?v==="green"?"border-green-500 bg-green-100 text-green-800 hover:bg-green-200 ring-2 ring-green-200":"border-red-500 bg-red-100 text-red-800 hover:bg-red-200 ring-2 ring-red-200":"border-gray-400 bg-white text-gray-600 hover:bg-gray-50"}`,[]),N=e.useMemo(()=>{const m="w-full font-semibold py-3 rounded-lg transition-all duration-200";return k?`${m} bg-blue-600 hover:bg-blue-700 text-white shadow-md hover:shadow-lg`:`${m} bg-gray-300 text-gray-500 cursor-not-allowed`},[k]),F=e.useMemo(()=>[t.jsx(G,{icon:t.jsx(ee,{}),onClick:P,title:"Utiliser ma position GPS",label:"Ma position",className:"flex items-center gap-1 border border-blue-400 bg-white text-blue-600 shadow-sm hover:bg-blue-50 hover:shadow-md transition-all duration-150","aria-label":"Utiliser ma position GPS"},"geolocation"),t.jsx(G,{icon:t.jsx(K,{isAnimated:C}),onClick:V,isActive:C,title:C?"Mode actif - Cliquez sur la carte pour sélectionner le départ, ou cliquez ici pour désactiver":"Activer le mode de sélection par clic sur la carte",label:t.jsx(Y,{isActive:C,inactiveLabel:"Clic carte"}),className:x(C,"green"),"aria-label":C?"Désactiver le mode clic carte":"Activer le mode clic carte"},"map-click")],[P,V,C,x]),q=e.useMemo(()=>[t.jsx(G,{icon:t.jsx(K,{isAnimated:w}),onClick:O,isActive:w,title:w?"Mode actif - Cliquez sur la carte pour sélectionner l'arrivée, ou cliquez ici pour désactiver":"Activer le mode de sélection par clic sur la carte pour l'arrivée",label:t.jsx(Y,{isActive:w,inactiveLabel:"Clic carte"}),className:x(w,"red"),"aria-label":w?"Désactiver le mode clic carte pour arrivée":"Activer le mode clic carte pour arrivée"},"map-click")],[O,w,x]);return t.jsxs(t.Fragment,{children:[t.jsx(J,{label:"Départ :",value:r,onChange:c,suggestions:o,onSuggestionClick:S,setSuggestions:s,placeholder:"Rechercher un lieu de départ...",actions:F}),t.jsx(J,{label:"Arrivée :",value:a,onChange:p,suggestions:d,onSuggestionClick:I,setSuggestions:u,placeholder:"Rechercher un lieu d'arrivée...",actions:q}),t.jsx(H,{className:N,onClick:j,disabled:!k,"aria-label":"Créer la trace avec les points sélectionnés",children:"Créer la trace"})]})},Ee=e.memo($e),te=e.memo(({query:r,onQueryChange:n,suggestions:o,onSuggestionSelect:s,onSearchClick:l,placeholder:a="Rechercher un lieu..."})=>{const i=e.useCallback(async()=>{r.length<3||await l()},[r,l]);return t.jsxs("div",{className:"relative",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(X,{className:"h-5 w-5 text-blue-600"}),t.jsx("input",{type:"text",className:"w-full px-3 py-2 border border-blue-400 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-300 transition-all duration-150 text-black",placeholder:a,value:r,onChange:d=>n(d.target.value),"aria-label":"Recherche de lieu"}),t.jsx(H,{type:"button",className:"px-3 py-2 border border-blue-400 bg-white text-blue-600 font-semibold hover:bg-blue-50",title:"Valider la recherche",onClick:i,"aria-label":"Lancer la recherche",children:t.jsx(X,{className:"h-5 w-5"})})]}),o?.length>0&&t.jsx("ul",{className:"absolute left-0 top-full w-full bg-white border rounded shadow-lg z-20 max-h-40 overflow-auto",role:"listbox","aria-label":"Suggestions de lieux",children:o.map(d=>t.jsx("li",{className:"px-3 py-2 cursor-pointer hover:bg-blue-100",onClick:()=>s(d),role:"option",children:d.display_name},`${d.place_id}-${d.display_name}`))})]})});te.displayName="LocationSearchBox";const re=e.memo(({error:r})=>t.jsxs("div",{className:"mt-2 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 font-semibold",role:"alert","aria-live":"polite",children:["⚠️ ",r]}));re.displayName="ErrorDisplay";const ne=e.memo(({icon:r,label:n,value:o,unit:s})=>t.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded",children:[t.jsxs("span",{className:"flex items-center gap-2 text-gray-700",children:[t.jsx("span",{"aria-hidden":"true",children:r}),n," :"]}),t.jsxs("span",{className:"font-semibold text-gray-900",children:[String(o),s&&t.jsx("span",{className:"text-sm text-gray-600 ml-1",children:s})]})]}));ne.displayName="SummaryItem";const se=e.memo(({summary:r,error:n})=>{const o=e.useMemo(()=>r?[{icon:"📏",label:"Distance",value:r.distance},{icon:"⏱️",label:"Durée estimée",value:r.duration},{icon:"📈",label:"Dénivelé positif",value:r.ascent??"N/A",unit:r.ascent?"m":void 0},{icon:"📉",label:"Dénivelé négatif",value:r.descent??"N/A",unit:r.descent?"m":void 0}]:[],[r]);return n?t.jsx(re,{error:n}):r?t.jsxs("div",{className:"mt-4 p-4 bg-white border border-gray-200 rounded-lg shadow-sm",role:"region","aria-label":"Résumé de l'itinéraire",children:[t.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-3 border-b border-gray-100 pb-2",children:"📊 Résumé de l'itinéraire"}),t.jsx("div",{className:"space-y-2",children:o.map((s,l)=>t.jsx(ne,{icon:s.icon,label:s.label,value:s.value,unit:s.unit},`${s.label}-${l}`))})]}):null});se.displayName="SummaryDisplay";const ae=e.memo(({id:r,icon:n,label:o,color:s,isActive:l,onClick:a})=>{const i=e.useMemo(()=>({backgroundColor:l?s:"white",borderColor:s,color:l?"white":s}),[l,s]),d=e.useMemo(()=>`flex items-center gap-2 transition-all duration-150 ${l?"bg-opacity-90 text-white border shadow-md":"bg-white hover:bg-opacity-10 border hover:shadow-sm"}`,[l]),u=e.useCallback(()=>{a(r)},[r,a]);return t.jsxs(H,{className:d,onClick:u,title:o,style:i,"aria-label":`${l?"Désactiver":"Activer"} le mode de transport ${o}`,children:[t.jsx(n,{className:"h-5 w-5","aria-hidden":"true"}),t.jsx("span",{className:"hidden sm:inline",children:o})]})});ae.displayName="TransportModeButton";const oe=e.memo(({activeRoutes:r=[],onProfileChange:n})=>{const o=e.useMemo(()=>new Set(r),[r]),s=e.useCallback(l=>{n(l)},[n]);return t.jsx("div",{className:"grid grid-cols-2 gap-2 mb-2",role:"group","aria-label":"Modes de transport",children:ve.map(({id:l,icon:a,label:i,color:d})=>t.jsx(ae,{id:l,icon:a,label:i,color:d,isActive:o.has(l),onClick:s},l))})});oe.displayName="TransportModeSelector";const le=e.memo(()=>t.jsx("div",{className:"mt-2 text-blue-600 font-medium animate-pulse",children:"Calcul de l'itinéraire en cours..."}));le.displayName="LoadingIndicator";const De=()=>{const[r,n]=e.useState("foot-hiking"),[o,s]=e.useState(""),[l,a]=e.useState([]),[i,d]=e.useState(!1),[u,f]=e.useState("osmFrance"),[g,M]=e.useState(!1),j=we(),L=e.useMemo(()=>({traceStart:j.traceStart,traceEnd:j.traceEnd,showTrace:i,profile:r,initialMapLayer:u}),[j.traceStart,j.traceEnd,i,r,u]),{mapRef:h,error:T,summary:b,isLoading:y,removeRoute:A,getActiveRoutes:R,enableMapClickForStart:B,disableMapClickForStart:C,clearStartMarker:$,enableMapClickForEnd:w,disableMapClickForEnd:E,clearEndMarker:_,createStartMarkerFromLocation:D,createEndMarkerFromLocation:z}=Me(L),[P,V]=e.useState([]);e.useEffect(()=>{(()=>{const N=R();V(F=>F.length!==N.length||!F.every(q=>N.includes(q))?N:F)})()},[b,R]);const O=e.useCallback(async x=>{if(x.length<3){a([]);return}try{const N=await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(x)}&limit=5`);if(!N.ok)throw new Error("Search failed");const F=await N.json();a(F)}catch{a([])}},[]),c=e.useCallback(x=>{s(x.display_name),a([]);const N=parseFloat(x.lat),F=parseFloat(x.lon);h?.current&&h.current.setView([N,F],13)},[h]),p=e.useCallback(x=>{P.includes(x)?A(x):n(x),requestAnimationFrame(()=>{V(R())})},[P,A,R]),S=e.useCallback(()=>{d(!1),requestAnimationFrame(()=>{d(!0)})},[]),I=e.useCallback(x=>{f(x)},[]),k=e.useMemo(()=>({...j,onCreateTrace:S,enableMapClickForStart:B,disableMapClickForStart:C,clearStartMarker:$,enableMapClickForEnd:w,disableMapClickForEnd:E,clearEndMarker:_,createStartMarkerFromLocation:D,createEndMarkerFromLocation:z}),[j,S,B,C,$,w,E,_,D,z]);return t.jsxs("div",{className:"relative h-screen w-screen bg-black",children:[t.jsxs("div",{className:"absolute top-6 left-6 z-10 bg-white p-6 rounded-xl min-w-[350px] w-fit flex flex-col gap-4 shadow-lg",children:[t.jsx(te,{query:o,onQueryChange:s,suggestions:l,onSuggestionSelect:c,onSearchClick:()=>O(o)}),t.jsx(oe,{activeRoutes:P,onProfileChange:p}),t.jsx(Ee,{...k}),t.jsx(se,{summary:b,error:T}),y&&t.jsx(le,{})]}),t.jsxs("div",{className:"absolute top-6 left-6 z-50",children:[t.jsxs("button",{onClick:()=>M(!g),className:`
            relative bg-white hover:bg-blue-50 border-2 rounded-xl p-3 shadow-xl
            transition-all duration-200 group
            ${g?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-400"}
          `,title:"🗺️ Changer le fond de carte",children:[t.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-blue-500 rounded-full animate-pulse"}),t.jsx("svg",{className:`w-6 h-6 transition-colors ${g?"text-blue-600":"text-gray-600 group-hover:text-blue-600"}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})})]}),g&&t.jsx("div",{className:"absolute top-12 left-0 min-w-[280px] z-50",children:t.jsx(ye,{map:h?.current||null,currentLayer:u,onLayerChange:I})})]}),t.jsx("div",{id:"map",className:"h-screen w-screen z-0"})]})},ze=e.memo(De);function Ze(){return t.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-emerald-400 via-teal-500 to-green-600",children:[t.jsx(Ce,{}),t.jsx("div",{className:"bg-gradient-to-r from-emerald-500 to-teal-600 text-white py-4 md:py-8",children:t.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[t.jsx("h1",{className:"text-2xl md:text-3xl font-bold mb-2",children:"Carte Interactive"}),t.jsx("p",{className:"text-sm md:text-base text-emerald-100",children:"Explorez les sentiers et planifiez vos randonnées"})]})}),t.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 md:py-6 pb-20 md:pb-6",children:t.jsx("div",{className:"bg-white/90 backdrop-blur-sm rounded-2xl shadow-xl border border-white/20 overflow-hidden",children:t.jsx("div",{className:"h-[50vh] sm:h-[60vh] md:h-[70vh] lg:h-[calc(100vh-160px)] xl:h-[calc(100vh-140px)]",children:t.jsx(ze,{})})})})]})}export{Ze as default};
